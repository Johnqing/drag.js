<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
<style>
    .drag{border:1px solid #000;position: absolute;top:0;left: 0;width: 200px;height: 200px;background: #f60;}
</style>
</head>
<body>
	<div id="move" class="drag"></div>
    <div>sd</div>
    <script>
    (function(win){
        var doc = win.document,
            bdy = doc.body;
        var baseMeth = {
            $: function(id){
                return doc.getElementById(id);
            },
            addEvent: function(elem, type, fn){
                if (elem.addEventListener) {
                    elem.addEventListener(type, fn, false);
                }else if(elem.attachEvent){
                    elem.attachEvent('on'+type, fn);
                }else{
                    elem['on'+type] = fn;
                }
            },
            removeEvent: function(elem, type, fn){
                if (elem.removeEventListener) {
                    elem.removeEventListener(type, fn, false);
                }else if(elem.detachEvent){
                    elem.detachEvent('on'+type, fn);
                }else{
                    elem['on'+type] = null;
                }
            },
            getEvent: function(evt){
                return evt || win.event;
            },
            getTarget: function(evt){
                return evt.target || evt.srcElement;
            }
            
        }
        /**
         * Class
         */
        var Drag = function(){
            this.drag = baseMeth.$('move');//修改为传参，以备后面拓展使用
            this.oldX = 0;
            this.oldY = 0;
            this.pos = null;//计数器
            this.flag = false;//阀门
            this.init();
        }
        Drag.prototype = {
            init: function(){
                var self = this;
                baseMeth.addEvent(doc, 'mousedown', function(e){
                    /**
                     * 记录鼠标按下位置
                     * @type {[type]}
                     */
                    var oldPos = self.getMousePos(e);
                    self.oldX = oldPos.x;
                    self.oldY = oldPos.y;
                    self.flag = true;
                });
                baseMeth.addEvent(doc, 'mousemove',  function(e){
                    self.move(e);
                });
                baseMeth.addEvent(doc, 'mouseup',  function(){
                    self.flag = false;
                });
            },
            move: function(e){
                this.pos = this.getMousePos(e);
                //阀门
                if(this.flag){
                    this.drag.style.left = (this.pos.x - this.oldX) + 'px';
                    this.drag.style.top = (this.pos.y - this.oldY) + 'px';
                    this.stopSlect();
                }
            },
            /**
             * 获取坐标位置
             * @param  {[Object]} e
             * @return {[Object]}   x y
             */
            getMousePos: function (e){
                var e = baseMeth.getEvent(e);
                if(e.pageX || e.pageY){
                     return {x:e.pageX, y:e.pageY};
                }
                return{
                    x:e.clientX + bdy.scrollLeft - bdy.clientLeft,
                    y:e.clientY + bdy.scrollTop - bdy.clientTop
                };
            },
            stopSlect: function(){
                win.getSelection ? win.getSelection().removeAllRanges() : doc.selection.empty();
            }
        }
        /**
         * 对外接口
         * @return {[type]} [description]
         */
        win.drag = function(){
            new Drag();
        };
    }(this));
    // 调用
    drag();
    </script>
</body>
</html>
